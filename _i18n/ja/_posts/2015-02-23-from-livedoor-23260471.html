---
layout: post
title: scalaと設定ファイル
subtitle: Livedoorブログからの移動
---
<div>Livedoorブログからの移動</div><hr />
<body><p>何かしらのアプリケーション(シェルコマンドレベルでも)を書くとき, 設定ファイルが必要になることは多い. rubyだったらYAMLとか, jsだったらJSONとか, いくつかの言語にはデファクトスタンダードがあるけどscalaにはまだ無いように思えるので, scalaで(比較的)簡単に使える設定ファイルの方式の一覧と, その選び方について自分の考え方をまとめてみようと思う.</p>
<h2 id="propertiesファイル-java">propertiesファイル (Java)</h2>
<p>Javaで用いられていた, 以下のようなファイル.</p>
<pre><code>key = value1
key.child = value2</code></pre>
<h4 id="利点">利点</h4>
<p>awk・シェルスクリプトとの相性が良い. そのため, これらと組み合わせる場合には便利である. 例えば, scalaでコマンドラインインターフェイスを作って, その補完ファイルをzshで書いた時に, 双方から設定ファイルを読み込まさなきゃいけない時など.</p>
<p>後, Java組み込みのAPIを使うのでもしかすると高速に読み書きができるかも. 未調査なので本当かは知らない.</p>
<h4 id="欠点">欠点</h4>
<p>階層的データ構造をつくろうとした時の記述量の増大, 多言語との互換性の低下, 文字列しかデータが扱えない, など欠点はいっぱいある.</p>
<h2 id="xml">XML</h2>
<h4 id="利点-1">利点</h4>
<p>scala言語構造にXMLリテラルがある. 実のところそれくらいしか利点はないように思う.</p>
<h4 id="欠点-1">欠点</h4>
<p>記述量が多い. 文字列しか扱えない. 正直設定ファイルとしてみるとJSONの下位互換なのではないかと思っている.</p>
<h2 id="json">JSON</h2>
<h4 id="利点-2">利点</h4>
<p>記述量が比較的少なく, また人間が読みやすい. JavaScriptなどでも用いられるので多言語との互換性も高められる.</p>
<h4 id="欠点-2">欠点</h4>
<p>組み込みのパーサは使いづらいので, play-jsonなど別途ライブラリを追加しないと使えない.</p>
<h2 id="scalaプログラム">scalaプログラム</h2>
<p>scalaで型(objectなりclassなり)を定義し, それを<a href="http://d.hatena.ne.jp/xuwei/20140607/1402128646">このページ</a>のようにリフレクション経由でコンパイルすることで設定ファイルとする方法.</p>
<h4 id="利点-3">利点</h4>
<p>静的型付きの設定ファイルが書ける. 設定ファイルの入力ミスについて自分であーだこーだやる必要がない..</p>
<p>また, scalaであるので関数を設定ファイルにかける. 従って, 例えば操作対象のファイルの情報を設定ファイルで記述したいとき, 他の方法だと拡張子のリストとか, 正規表現とかで扱うしかないが, scalaであれば<code>File -&gt; Boolean</code>の関数として書ける.</p>
<p>最後に, scalaの暗黙変換とかを使うことで, 記法もかなり自由に設定できる.</p>
<h4 id="欠点-3">欠点</h4>
<p>readが遅く, writeが難しい. ただ, 事前コンパイルができるのであれば多分事前コンパイルしてそのバイナリをクラスパスに動的追加することで高速なreadが可能になると思われる. また, 非同期IOを用いて, その間に別の処理を行うこともscalaだと割と簡単なのでそれによる高速化もできる.</p>
<h2 id="選択方法">選択方法</h2>
<p>個人的には, 静的型安全であるとか色々な理由でscalaプログラムを使いたい. そしてそれがだめならJSON, propertiesファイルの順で使いたい. 従って, 設定ファイルの選択方法は次のような感じかなぁ.</p>
<ul>
<li>そもそも起動に時間がかかるアプリケーションである(IDEなど). または, 設定ファイル読み込み以外にボトルネックがある(e.g. ネットワークアクセス)</li>
<li>Yes
<ul>
<li>scalaプログラム + 非同期IO</li>
</ul></li>
<li>No
<ul>
<li>設定ファイルはめったに変更されない.</li>
<li>Yes
<ul>
<li>scalaプログラム + 事前コンパイル</li>
</ul></li>
<li>No
<ul>
<li>シェルスクリプトからも読み込む必要がある.</li>
<li>Yes
<ul>
<li>propertiesファイル</li>
</ul></li>
<li>No
<ul>
<li>JSONフォーマット</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</body>