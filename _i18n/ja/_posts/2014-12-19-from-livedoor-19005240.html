---
layout: post
title: scala備忘録
subtitle: Livedoorブログからの移動
---
<div>Livedoorブログからの移動</div><hr />
<body>忘れててひどい目にあったものを書いておく.<br/><br/><b><span style="font-size: medium;">scala.collection.Setとscala.Predef.Setは違う</span></b><br/>scala.Predef.Setは, immutableなSetのこと. 一方, scala.collection.Setはmutableも含む.<br/>mutableであるものをmutableと明示しようとして, <br/> 
<pre>def func(s: Set[Int]) = println(s)
import scala.collection._
val set1 = mutable.Set[Int]()
val set2 = Set(1, 2, 3)
func(set2)<br/>
</pre>
とかやると, funcの引数のsはscala.Predef.Set, set2はscala.collection.Setとなってエラーを起こす.<br/>こういう場合は面倒くさくても import scala.collection.mutableと書くべき.<br/><br/><b><span style="font-size: medium;">Arrayのequalsは要素比較をしない.</span></b><br/>scalaのArrayは要するにJavaの配列のラッパ. なので, toStringしても要素が並ぶわけではないし, 例えば, Array(1, 2, 3) == Array(1, 2, 3)はfalseとなる.<br/>どうするのが適切なのかはわからないが, toSeqとかでSeqに直せば比較できる. <br/><br/><b><span style="font-size: medium;">scala.sys.processにおける"" </span></b>(2015/1/2追記)<br/>scala.sys.processは面倒くさい処理を全部シェルスクリプトに投げられる便利なライブラリ. 特に自分はファイルアクセスなどに使っている. 例えば, カレントディレクトリ以下の拡張子がscalaのファイルすべてを取得する際, sys.processを使えば以下だけで良い(Unix専用? windowsでｓcala使ったことがないので知らない).<br/><pre>// scala.sys.processを使う場合
import scala.sys.process._
("find ./ -name *.scala" lines_!) map (x =&gt; s"cat $x".!!)
</pre>
これをjavaの標準ライブラリでやろうとした場合にどれだけの行数になるかは考えたくもないし, scala.ioは遅い.<br/>もちろんOS依存が強いので, 個人的に使うプログラムや, 小規模なスクリプトに使用は限定するべき.<br/><br/>ただ, ""がいわゆるシェルスクリプトの""や''と違うことに注意する必要がある. 例えば, 以下は1列目だけを表示する簡単なawkスクリプトを実行するコマンドである.<br/><pre>$ awk '{print $1}' file
</pre>
この時, shell(bash, zsh等, 他は知らない)は, まず"awk", "'{print $1}'" "file"の3引数に分解し, 次に, '{print $1}'を{print $1}と評価し(評価っていうのだろうか), "awk" "{print $1}" "file"という3引数として実行する.<br/><br/>一方,  
<pre>import scala.sys.process._
"awk \"{print $1}\" file".!!
</pre>
は, "awk" "{print" "$1}" "file"の4引数に分解される. なのでこれはawkスクリプトとしてparseできずにエラーを吐いて死ぬ.<br/>こういう場合はSeq[String]からProcessへのimplicit conversionを用いて,  
<pre>Seq("awk", "{print $1}", "file").!!
</pre>
と書かなければならない. ""と''と``の違いなど, shell scriptをそのまま実行しようとするには面倒くさいことが多いので, しょうがない仕様だとは思うが, 若干面倒.<br/><br/>

<b><span style="font-size: medium;">Console.outとかの取得方法<br/><br/></span></b>標準入力や標準出力の内容を取得したくなった時の方法について. まぁ特にテスト中に用いるかな？　javaだと, System.setOut(...)して, その後, System.out.println(...)をして, また, System.setOut(original)で戻すみたいな流れを踏む.<br/>scalaの場合は昔はConsole.setOutがあったんだけど非推奨になっていたので, 代わりのAPIを見たらwithOutというのがあった. <br/>最初見た時は"without"だと思ったんだけど, "with (std)out"という意味らしい. 使い方は, <br/>
<pre>Console.withOut(new ByteArrayOutputStream) {
  println("foo")
  println("bar")
}
</pre>
みたいな感じ. こうすると, printlnしているところだけstdoutがByteArrayOutputStreamになり, それ以外は標準出力に行く.<br/>遅延評価と複数引数リストを組み合わせたこの定義は割とscalaらしいと思った.
</body>